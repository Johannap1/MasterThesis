<?xml version="1.0"?>

<launch>
    <!-- General parameters -->
    <arg name="verbose" default="false"/>
    <arg name="enable_record" default="true"/>
    <arg name="model_name" default="drone_hovergames"/>
    <arg name="dt" default="0.05"/>       <!-- value should correspond with integrator_stepsize in hovergames_settings.py! -->
    <arg name="nonlin_control" default="true"/> <!-- value should correspond with model option nonlin in hovergames_settings.py! -->
    <arg name="with_yaw" default="true"/> <!-- value should correspond with model option with_yaw in hovergames_settings.py! -->
    <arg name="enable_wind" default="true"/> <!-- Set to true to add wind disturbance in simulator-->
    <arg name="nonlin_sim" default="true"/> <!-- simulation model to use: could be linear or nonlinear independent of model used in LMPCC-->
    <arg name="use_static_obstacle_map" default="false"/>
    <!-- Experiment settings -->
    <arg name="sim" default="false"/>
    <arg name="drone_name" default="hovergames"/>
    <arg name="run_px4_control_interface" default="true"/>
    <arg name="px4_control_interface_param_file" default="$(find px4_tools)/config/px4_control_interface_simple_controller.yaml"/>


    <arg unless="$(arg verbose)" name="arg_verbose" value=""/>
    <arg     if="$(arg verbose)" name="arg_verbose" value="-v"/>

    <!-- Load robot_description and publish the states on tf -->
    <include file="$(find drone_description)/launch/drone_description.launch">
        <arg name="drone_name" value="$(arg drone_name)"/>
    </include>

    <!-- Launch Gazebo if sim is set to true -->
    <group if="$(arg sim)">
        <include file="$(find drone_gazebo)/launch/gazebo_world.launch"/>
    </group>

    <!-- Launch PX4 control interface, MAVROS, PX4 SITL and spawn vehicle -->
    <include file="$(find px4_tools)/launch/px4_tools.launch">
        <arg name="sim" value="$(arg sim)"/>
        <arg name="drone_name" value="$(arg drone_name)"/>
        <arg name="run_px4_control_interface" value="$(arg run_px4_control_interface)"/>
        <arg name="px4_control_interface_param_file" value="$(arg px4_control_interface_param_file)"/>
    </include>

    <!-- Run simulation node -->
    <node pkg="hovergames_simplesim_control" type="control_node_gazebo" name="control_node_gazebo"
      args="--dt $(arg dt) $(arg arg_verbose)"
      output="screen" cwd="node" required="True">
    </node>

    <!-- Run gp node -->
    <node pkg="hovergames_simplesim_control" type="gp_node" name="gp_node"
      args="--dt $(arg dt) $(arg arg_verbose)"
      output="screen" cwd="node" required="True">
    </node>

  <node pkg="rosbag" name="record" type="record"
  args="-o simplecontrol_windsimplesim_2_fans_random_tsp_path.bag
      /drone_hovergames/state
      /drone_hovergames/control
      /drone_hovergames/state_prediction
      /drone_hovergames/wind"
  />

</launch>
